<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rialo Adventure</title>
  <!--
    Rialo Adventure - single-file Phaser 3 platformer template

    Petunjuk singkat:
    1) Ganti sprite karakter dengan sample gambar Anda: tempatkan file di folder `assets/` dan beri nama `rialo.png` (atau ubah nama di preload).
    2) Tambahkan aset lain di folder `assets/` (coin.png, enemy.png) jika ingin; placeholder sudah dipakai.
    3) Untuk menaruh di GitHub Pages: buat repo, commit file ini sebagai index.html, push, lalu aktifkan GitHub Pages (branch main/root). Halaman akan tersedia di https://<username>.github.io/<repo>/

    Lisensi & kredit: kode ini bebas dipakai (MIT-like). Pastikan gambar yang Anda pakai punya hak pakai yang sesuai.
  -->
  <style>
    html,body { height:100%; margin:0; background:#6ec1ff; }
    #game-container { width:100%; height:100vh; display:flex; align-items:center; justify-content:center; }
    canvas{ image-rendering: pixelated; }
    .info { position:fixed; left:12px; top:12px; color:#fff; font-family:Arial,Helvetica,sans-serif; background:rgba(0,0,0,0.25); padding:8px 10px; border-radius:8px; }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <div class="info">Rialo Adventure â€” Panah kiri/kanan untuk bergerak, spasi untuk lompat</div>

  <!-- Phaser 3 dari CDN -->
  <script src="https://unpkg.com/phaser@3.60.0/dist/phaser.min.js"></script>
  <script>
    // Konfigurasi game
    const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      width: 960,
      height: 540,
      physics: {
        default: 'arcade',
        arcade: { gravity: { y: 1000 }, debug: false }
      },
      scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);

    let player, cursors, platforms, coins, scoreText, score = 0, enemies;

    function preload() {
      // Ganti file-file ini dengan file Anda di folder assets/
      this.load.image('bg', 'assets/bg.png');          // background (optional)
      this.load.image('ground', 'assets/ground.png');  // platform image (repeat-able)
      this.load.image('coin', 'assets/coin.png');
      this.load.image('enemy', 'assets/enemy.png');
      // sprite karakter utama (pakai sample Anda) -> gunakan ukuran sprite sekitar 48x48 atau sesuaikan frame
      this.load.spritesheet('rialo', 'assets/rialo.png', { frameWidth: 48, frameHeight: 48 });
    }

    function create() {
      // Background
      if (this.textures.exists('bg')) {
        this.add.tileSprite(0, 0, config.width, config.height, 'bg').setOrigin(0);
      } else {
        this.cameras.main.setBackgroundColor('#6ec1ff');
      }

      // Platform statis
      platforms = this.physics.add.staticGroup();
      // ground
      for (let x = 0; x < config.width; x += 128) {
        platforms.create(x + 64, config.height - 32, 'ground').setScale(1).refreshBody();
      }
      // beberapa platform terangkat
      platforms.create(200, 380, 'ground').setScale(0.6,1).refreshBody();
      platforms.create(480, 300, 'ground').setScale(0.6,1).refreshBody();
      platforms.create(760, 220, 'ground').setScale(0.6,1).refreshBody();

      // Player
      player = this.physics.add.sprite(100, config.height - 150, 'rialo');
      player.setBounce(0.1);
      player.setCollideWorldBounds(true);
      player.body.setSize(32, 44).setOffset(8,4);

      // Animasi
      this.anims.create({ key: 'idle', frames: [{ key: 'rialo', frame: 0 }], frameRate: 10 });
      this.anims.create({ key: 'run', frames: this.anims.generateFrameNumbers('rialo', { start: 1, end: 4 }), frameRate: 12, repeat: -1 });
      this.anims.create({ key: 'jump', frames: [{ key: 'rialo', frame: 5 }], frameRate: 10 });

      // Koin
      coins = this.physics.add.group({ key: 'coin', repeat: 8, setXY: { x: 120, y: 0, stepX: 90 } });
      coins.children.iterate(function (child) { child.setBounceY(Phaser.Math.FloatBetween(0.2, 0.6)); });

      // Musuh
      enemies = this.physics.add.group();
      spawnEnemy(this, 600, config.height - 80);

      // Collider
      this.physics.add.collider(player, platforms);
      this.physics.add.collider(coins, platforms);
      this.physics.add.collider(enemies, platforms);

      this.physics.add.overlap(player, coins, collectCoin, null, this);
      this.physics.add.collider(player, enemies, playerHit, null, this);

      // Controls
      cursors = this.input.keyboard.createCursorKeys();
      this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

      // UI
      scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '20px', fill: '#fff' }).setScrollFactor(0);

      // Kamera mengikuti pemain
      this.cameras.main.startFollow(player, true, 0.08, 0.08);
      this.cameras.main.setBounds(0, 0, config.width, config.height);
    }

    function update() {
      if (!player) return;

      const left = cursors.left.isDown;
      const right = cursors.right.isDown;
      const jump = Phaser.Input.Keyboard.JustDown(cursors.space) || Phaser.Input.Keyboard.JustDown(cursors.up);

      if (left) {
        player.setVelocityX(-200);
        player.anims.play('run', true);
        player.flipX = true;
      } else if (right) {
        player.setVelocityX(200);
        player.anims.play('run', true);
        player.flipX = false;
      } else {
        player.setVelocityX(0);
        player.anims.play('idle', true);
      }

      // lompat
      if (jump && player.body.touching.down) {
        player.setVelocityY(-450);
        player.anims.play('jump');
      }

      // musuh sederhana: bergerak bolak-balik
      enemies.getChildren().forEach(e => {
        if (!e.body) return;
        if (e.x < e.minX) e.setVelocityX(80);
        if (e.x > e.maxX) e.setVelocityX(-80);
      });
    }

    // Helper: spawn enemy dengan area patroli
    function spawnEnemy(scene, x, y) {
      const e = enemies.create(x, y, 'enemy');
      e.setCollideWorldBounds(true);
      e.setBounce(0);
      e.setVelocityX(Phaser.Math.Between(-80, 80));
      e.minX = x - 120; e.maxX = x + 120;
      e.body.setSize(e.width - 8, e.height - 8);
    }

    // Ambil koin
    function collectCoin(player, coin) {
      coin.disableBody(true, true);
      score += 10; scoreText.setText('Score: ' + score);

      // respawn koin jika habis
      if (coins.countActive(true) === 0) {
        coins.children.iterate(function(child){ child.enableBody(true, child.x, 0, true, true); });
        // spawn musuh tambahan untuk tantangan
        spawnEnemy(this, Phaser.Math.Between(200, 800), config.height - 80);
      }
    }

    function playerHit(playerObj, enemyObj) {
      // Jika pemain jatuh di atas musuh -> hancurkan musuh
      if (playerObj.body.velocity.y > 0 && playerObj.y < enemyObj.y) {
        enemyObj.disableBody(true, true);
        playerObj.setVelocityY(-220);
        score += 50; scoreText.setText('Score: ' + score);
      } else {
        // reset game (simple)
        this.cameras.main.shake(200, 0.01);
        playerObj.setTint(0xff0000);
        playerObj.anims.play('idle');
        playerObj.setVelocity(0,0);
        this.time.delayedCall(500, () => {
          playerObj.clearTint();
          playerObj.setPosition(100, config.height - 150);
          score = 0; scoreText.setText('Score: ' + score);
          coins.children.iterate(c => c.enableBody(true, c.x, 0, true, true));
          enemies.clear(true,true);
          spawnEnemy(this, 600, config.height - 80);
        });
      }
    }
  </script>
</body>
</html>
